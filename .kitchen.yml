driver:
  name: vagrant
  customize:
    cpus: 2
    memory: 4096

transport:
  name: winrm
  elevated: true

provisioner:
  name: chef_zero
  deprecations_as_errors: true
  retry_on_exit_code:
    - 35 # 35 is the exit code signaling that the node is rebooting
  wait_for_retry: 90 # given the reboot option delays a minute before trying to reboot, we should wait to reconnect
  max_retries: 3
  client_rb:
    exit_status: :enabled # Opt-in to the standardized exit codes
    client_fork: false  # Forked instances don't return the real exit code
  attributes:
    powershell:
      installation_reboot_mode: immediate_reboot

platforms:
  - name: windows-7
    driver_config:
      box: chef/windows-7-professional
  - name: windows-8.1
    driver_config:
      box: chef/windows-8.1-professional
  - name: windows-2008r2
    driver_config:
      box: chef/windows-server-2008r2-standard
  - name: windows-2012r2
    driver_config:
      box: chef/windows-server-2012r2-standard

suites:
  - name: powershell2
    run_list:
      - recipe[powershell::powershell2]
    includes:
      - windows-2008r2
      - windows-7
  - name: powershell3
    run_list:
      - recipe[powershell::powershell3]
    includes:
      - windows-2008r2
      - windows-7
  - name: powershell4
    attributes:
      ms_dotnet:
        v4:
          version: '4.5.1'
    run_list:
      - recipe[powershell::powershell4]
    includes:
      - windows-2008r2
      - windows-7
  - name: powershell5
    run_list:
      - recipe[powershell::powershell5]
    includes:
      - windows-8.1
      - windows-2012r2
  - name: custom_resource
    run_list:
      - recipe[test::default]
